image: registry.git.fh-aachen.de/ba-vd/sfm-pipeline/rcsop-gitlab-ci:generic

before_script:
  - curl -L -S -o inputs.tar.xz 'https://dobrovolskis.com/public/sfm/rcsop-input-ci.tar.xz'
  - tar -xf inputs.tar.gz
  - rm inputs.tar.gz

cache:
  key: "$CI_PIPELINE_ID"
  paths:
    - build
    - input

stages:
  - build
  - test

Build launcher:
  stage: build
  script:
    - mkdir build
    - cd build && cmake .. -DCMAKE_BUILD_TYPE=Release
    - make -j 8

Test task "Azimuth RCS":
  stage: test
  script:
    - mkdir output
    - ./build/launcher/rcs-overlay-plotter -T "azimuth-rcs" -I input -O output -M false
  artifacts:
    paths:
      - output
    expire_in: never

Test task "RCS slices":
  stage: test
  script:
    - mkdir output
    - ./build/launcher/rcs-overlay-plotter -T "rcs-slices" -I input -O output -M false
  artifacts:
    paths:
      - output
    expire_in: never

Test dummy task:
  stage: test
  script:
    - mkdir output
    - ./build/launcher/rcs-overlay-plotter -T "test-task" -I input -O output -M false
  artifacts:
    paths:
      - output
    expire_in: never
